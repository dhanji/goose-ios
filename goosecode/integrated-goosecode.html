<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GooseCode Pro - Enhanced VIM/EMACS Style Coding Agent</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        /* Enhanced features styling */
        .ai-status {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            margin-left: 8px;
        }
        
        .ai-connected {
            background: #4CAF50;
            color: #000;
        }
        
        .ai-offline {
            background: #FF9800;
            color: #000;
        }
        
        .template-selector {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2d2d2d;
            border: 1px solid #404040;
            border-radius: 8px;
            padding: 20px;
            max-width: 400px;
            z-index: 1001;
            display: none;
        }
        
        .template-item {
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
            margin: 4px 0;
            transition: background 0.2s;
            border: 1px solid transparent;
        }
        
        .template-item:hover {
            background: #404040;
            border-color: #4CAF50;
        }
        
        .ai-thinking {
            opacity: 0.7;
            font-style: italic;
        }
        
        .code-suggestion {
            background: #1a1a1a;
            border: 1px solid #4CAF50;
            border-radius: 4px;
            padding: 8px;
            margin: 8px 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
        }
        
        .suggestion-actions {
            margin-top: 8px;
            display: flex;
            gap: 8px;
        }
        
        .suggestion-btn {
            background: #4CAF50;
            border: none;
            color: #000;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }
        
        .suggestion-btn:hover {
            background: #45a049;
        }
        
        .error-highlight {
            background: rgba(244, 67, 54, 0.2);
            border-left: 3px solid #f44336;
        }
        
        .export-btn {
            background: #2196F3;
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            margin-left: 8px;
        }
        
        .import-btn {
            background: #FF9800;
            border: none;
            color: #000;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            margin-left: 8px;
        }
    </style>
</head>
<body>
    <div id="app" class="app-container">
        <!-- Top Menu Bar -->
        <div class="menu-bar">
            <div class="menu-section">
                <span class="logo">ü™ø GooseCode Pro</span>
                <div class="menu-items">
                    <button class="menu-btn active" data-mode="code">Code</button>
                    <button class="menu-btn" data-mode="preview">Preview</button>
                    <button class="menu-btn" data-mode="split">Split</button>
                </div>
                <span class="ai-status ai-offline" id="aiStatus">AI Offline</span>
            </div>
            <div class="menu-section">
                <button class="export-btn" id="exportBtn">Export</button>
                <button class="import-btn" id="importBtn">Import</button>
                <input type="file" id="importFile" style="display: none;" accept=".json">
                <div class="status-info">
                    <span class="mode-indicator">NORMAL</span>
                    <span class="file-info">untitled.html</span>
                    <span class="cursor-pos">1:1</span>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Left Sidebar (File Explorer / Agent Chat) -->
            <div class="sidebar left-sidebar" id="leftSidebar">
                <div class="sidebar-tabs">
                    <button class="tab-btn active" data-tab="files">Files</button>
                    <button class="tab-btn" data-tab="agent">Agent</button>
                </div>
                
                <!-- File Explorer -->
                <div class="tab-content active" id="files-tab">
                    <div class="file-tree">
                        <div class="file-item folder">
                            <span class="folder-icon">üìÅ</span>
                            <span class="file-name">project</span>
                        </div>
                        <div class="file-item file active">
                            <span class="file-icon">üìÑ</span>
                            <span class="file-name">index.html</span>
                        </div>
                        <div class="file-item file">
                            <span class="file-icon">üé®</span>
                            <span class="file-name">styles.css</span>
                        </div>
                        <div class="file-item file">
                            <span class="file-icon">‚ö°</span>
                            <span class="file-name">script.js</span>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Agent Chat -->
                <div class="tab-content" id="agent-tab">
                    <div class="agent-chat">
                        <div class="chat-messages" id="chatMessages">
                            <div class="message agent-message">
                                <div class="message-header">
                                    <span class="sender">ü§ñ GPT-5 Code</span>
                                    <span class="timestamp">Ready</span>
                                </div>
                                <div class="message-content">
                                    Hello! I'm your enhanced coding assistant. I can help you build applications with HTML, CSS, JavaScript, and Canvas. 
                                    
                                    <strong>New features:</strong>
                                    ‚Ä¢ Real-time code analysis
                                    ‚Ä¢ Smart suggestions
                                    ‚Ä¢ Error detection
                                    ‚Ä¢ Template generation
                                    
                                    What would you like to create?
                                </div>
                            </div>
                        </div>
                        <div class="chat-input-container">
                            <textarea class="chat-input" placeholder="Ask the AI agent for help with your code..." rows="3"></textarea>
                            <button class="send-btn">Send</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Center Panel (Code Editor / Preview) -->
            <div class="center-panel">
                <!-- Code Editor -->
                <div class="editor-container" id="editorContainer">
                    <div class="editor-header">
                        <div class="editor-tabs">
                            <div class="editor-tab active">
                                <span class="tab-name">index.html</span>
                                <button class="tab-close">√ó</button>
                            </div>
                            <button class="new-tab-btn">+</button>
                        </div>
                    </div>
                    <div class="editor-content">
                        <div class="line-numbers" id="lineNumbers">
                            <div class="line-number">1</div>
                            <div class="line-number">2</div>
                            <div class="line-number">3</div>
                            <div class="line-number">4</div>
                            <div class="line-number">5</div>
                        </div>
                        <textarea class="code-editor" id="codeEditor" spellcheck="false"><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GooseCode Pro Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        canvas {
            border: 2px solid white;
            border-radius: 10px;
            margin: 20px 0;
            cursor: crosshair;
        }
        .controls {
            margin: 20px 0;
        }
        button {
            background: #4CAF50;
            border: none;
            color: white;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü™ø GooseCode Pro</h1>
        <p>Enhanced VIM/EMACS style coding environment with AI assistance</p>
        
        <canvas id="myCanvas" width="600" height="400"></canvas>
        
        <div class="controls">
            <button onclick="drawCircle()">Draw Circle</button>
            <button onclick="drawSquare()">Draw Square</button>
            <button onclick="animate()">Animate</button>
            <button onclick="clearCanvas()">Clear</button>
        </div>
        
        <p>Try the enhanced features:</p>
        <ul style="text-align: left; max-width: 400px; margin: 0 auto;">
            <li>Press ':' for VIM command palette</li>
            <li>Use AI chat for code assistance</li>
            <li>Real-time error checking</li>
            <li>Smart auto-completion</li>
            <li>Export/Import projects</li>
        </ul>
    </div>
    
    <script>
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');
        let animationId;
        
        function drawCircle() {
            ctx.fillStyle = '#4CAF50';
            ctx.beginPath();
            ctx.arc(300, 200, 50, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function drawSquare() {
            ctx.fillStyle = '#2196F3';
            ctx.fillRect(250, 150, 100, 100);
        }
        
        function animate() {
            let x = 0;
            function frame() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#FF9800';
                ctx.beginPath();
                ctx.arc(50 + x, 200, 20, 0, Math.PI * 2);
                ctx.fill();
                
                x += 2;
                if (x < canvas.width - 100) {
                    animationId = requestAnimationFrame(frame);
                }
            }
            frame();
        }
        
        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
        }
        
        // Interactive canvas
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            ctx.fillStyle = '#E91E63';
            ctx.beginPath();
            ctx.arc(x, y, 10, 0, Math.PI * 2);
            ctx.fill();
        });
    </script>
</body>
</html></textarea>
                    </div>
                </div>

                <!-- Preview Panel -->
                <div class="preview-container" id="previewContainer" style="display: none;">
                    <div class="preview-header">
                        <div class="preview-controls">
                            <button class="control-btn" id="refreshBtn">üîÑ Refresh</button>
                            <button class="control-btn" id="fullscreenBtn">‚õ∂ Fullscreen</button>
                        </div>
                    </div>
                    <iframe class="preview-frame" id="previewFrame" sandbox="allow-scripts allow-same-origin"></iframe>
                </div>
            </div>

            <!-- Right Sidebar (Tools / Console) -->
            <div class="sidebar right-sidebar" id="rightSidebar">
                <div class="sidebar-tabs">
                    <button class="tab-btn active" data-tab="console">Console</button>
                    <button class="tab-btn" data-tab="tools">Tools</button>
                </div>
                
                <!-- Console -->
                <div class="tab-content active" id="console-tab">
                    <div class="console">
                        <div class="console-output" id="consoleOutput">
                            <div class="console-line info">GooseCode Pro Console Ready</div>
                            <div class="console-line">Enhanced features loaded</div>
                            <div class="console-line">Type 'help' for available commands</div>
                        </div>
                        <div class="console-input-container">
                            <span class="console-prompt">></span>
                            <input type="text" class="console-input" placeholder="Enter command...">
                        </div>
                    </div>
                </div>

                <!-- Enhanced Tools -->
                <div class="tab-content" id="tools-tab">
                    <div class="tools-panel">
                        <div class="tool-section">
                            <h3>AI Assistance</h3>
                            <button class="tool-btn" data-action="ai-debug">Debug Code</button>
                            <button class="tool-btn" data-action="ai-optimize">Optimize Code</button>
                            <button class="tool-btn" data-action="ai-explain">Explain Code</button>
                            <button class="tool-btn" data-action="ai-generate">Generate Code</button>
                        </div>
                        <div class="tool-section">
                            <h3>Quick Actions</h3>
                            <button class="tool-btn" data-action="format">Format Code</button>
                            <button class="tool-btn" data-action="validate">Validate HTML</button>
                            <button class="tool-btn" data-action="minify">Minify CSS</button>
                            <button class="tool-btn" data-action="syntax-check">Check JS Syntax</button>
                        </div>
                        <div class="tool-section">
                            <h3>Templates</h3>
                            <button class="tool-btn" data-action="template-html5">HTML5 Boilerplate</button>
                            <button class="tool-btn" data-action="template-canvas">Canvas Animation</button>
                            <button class="tool-btn" data-action="template-game">Simple Game</button>
                            <button class="tool-btn" data-action="template-viz">Data Visualization</button>
                        </div>
                        <div class="tool-section">
                            <h3>Advanced</h3>
                            <button class="tool-btn" data-action="zen-mode">Zen Mode</button>
                            <button class="tool-btn" data-action="focus-mode">Focus Mode</button>
                            <button class="tool-btn" data-action="theme-toggle">Toggle Theme</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Command Palette -->
        <div class="command-palette" id="commandPalette" style="display: none;">
            <div class="command-input-container">
                <span class="command-prefix">:</span>
                <input type="text" class="command-input" placeholder="Enter command...">
            </div>
            <div class="command-suggestions">
                <div class="suggestion">save - Save current file</div>
                <div class="suggestion">ai [question] - Ask AI assistant</div>
                <div class="suggestion">template - Show template selector</div>
                <div class="suggestion">zen - Toggle zen mode</div>
                <div class="suggestion">export - Export project</div>
                <div class="suggestion">theme - Toggle theme</div>
                <div class="suggestion">debug - Debug current code</div>
            </div>
        </div>

        <!-- Template Selector -->
        <div class="template-selector" id="templateSelector">
            <h3 style="margin-top: 0; color: #4CAF50;">Select Template</h3>
            <div class="template-item" data-template="html5">üìÑ HTML5 Boilerplate</div>
            <div class="template-item" data-template="canvas-game">üéÆ Canvas Game Starter</div>
            <div class="template-item" data-template="data-viz">üìä Data Visualization</div>
            <div class="template-item" data-template="interactive-form">üìù Interactive Form</div>
            <div class="template-item" data-template="animation">‚ú® CSS Animation Demo</div>
            <div class="template-item" data-template="api-demo">üåê API Integration Demo</div>
            <button style="margin-top: 10px; background: #666; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;" onclick="hideTemplateSelector()">Cancel</button>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-left">
                <span class="status-item">Ready</span>
                <span class="status-item">HTML</span>
                <span class="status-item">UTF-8</span>
                <span class="status-item" id="aiIndicator">AI: Offline</span>
            </div>
            <div class="status-right">
                <span class="status-item">Spaces: 2</span>
                <span class="status-item">Line 1, Col 1</span>
                <span class="status-item">100%</span>
            </div>
        </div>
    </div>

    <!-- Load all scripts -->
    <script src="script.js"></script>
    <script src="ai-config.js"></script>
    <script src="enhanced-features.js"></script>
    
    <script>
        // Initialize enhanced GooseCode
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize AI agent
            const aiAgent = new AICodeAgent({
                // Add your API key here for real GPT-5 Code integration
                // apiKey: 'your-api-key-here',
                model: 'gpt-4-code', // Will be 'gpt-5-code' when available
                temperature: 0.1
            });
            
            // Initialize enhanced editor
            window.gooseCode = new EnhancedGooseCode();
            window.aiAgent = aiAgent;
            
            // Setup enhanced chat functionality
            setupEnhancedChat();
            setupEnhancedTools();
            setupProjectManagement();
            
            console.log('GooseCode Pro initialized with enhanced features!');
        });
        
        function setupEnhancedChat() {
            const sendBtn = document.querySelector('.send-btn');
            const chatInput = document.querySelector('.chat-input');
            
            sendBtn.addEventListener('click', async () => {
                await sendEnhancedMessage();
            });
            
            chatInput.addEventListener('keydown', async (e) => {
                if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                    await sendEnhancedMessage();
                }
            });
        }
        
        async function sendEnhancedMessage() {
            const chatInput = document.querySelector('.chat-input');
            const message = chatInput.value.trim();
            
            if (!message) return;
            
            // Add user message
            addChatMessage('user', message);
            chatInput.value = '';
            
            // Show AI thinking
            const thinkingMsg = addChatMessage('agent', 'Analyzing your code and thinking...');
            thinkingMsg.classList.add('ai-thinking');
            
            // Get current code context
            const currentCode = document.getElementById('codeEditor').value;
            window.aiAgent.updateCodeContext(currentCode);
            
            // Get AI response
            const response = await window.aiAgent.askCodeQuestion(message, currentCode);
            
            // Remove thinking message and add real response
            thinkingMsg.remove();
            const responseMsg = addChatMessage('agent', response);
            
            // Check if response contains code suggestions
            if (response.includes('```')) {
                addCodeSuggestions(responseMsg, response);
            }
        }
        
        function addChatMessage(sender, content) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const now = new Date();
            const timestamp = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-header">
                    <span class="sender">${sender === 'user' ? 'üë§ You' : 'ü§ñ GPT-5 Code'}</span>
                    <span class="timestamp">${timestamp}</span>
                </div>
                <div class="message-content">${formatMessage(content)}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            return messageDiv;
        }
        
        function formatMessage(content) {
            // Convert markdown-style code blocks to HTML
            return content
                .replace(/```(\w+)?\n([\s\S]*?)```/g, '<div class="code-suggestion"><pre><code>$2</code></pre><div class="suggestion-actions"><button class="suggestion-btn" onclick="applySuggestion(this)">Apply</button><button class="suggestion-btn" onclick="copySuggestion(this)">Copy</button></div></div>')
                .replace(/`([^`]+)`/g, '<code style="background: #333; padding: 2px 4px; border-radius: 3px;">$1</code>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>');
        }
        
        function addCodeSuggestions(messageElement, response) {
            // Extract code blocks and add interactive buttons
            const codeBlocks = messageElement.querySelectorAll('.code-suggestion');
            codeBlocks.forEach(block => {
                const code = block.querySelector('code').textContent;
                // Code suggestions are already handled in formatMessage
            });
        }
        
        function applySuggestion(button) {
            const codeBlock = button.closest('.code-suggestion').querySelector('code');
            const code = codeBlock.textContent;
            
            const codeEditor = document.getElementById('codeEditor');
            codeEditor.value = code;
            window.gooseCode.updateLineNumbers();
            window.gooseCode.updatePreview();
            
            window.gooseCode.addConsoleMessage('Code suggestion applied', 'info');
        }
        
        function copySuggestion(button) {
            const codeBlock = button.closest('.code-suggestion').querySelector('code');
            const code = codeBlock.textContent;
            
            navigator.clipboard.writeText(code).then(() => {
                window.gooseCode.addConsoleMessage('Code copied to clipboard', 'info');
            });
        }
        
        function setupEnhancedTools() {
            document.querySelectorAll('[data-action]').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const action = e.target.dataset.action;
                    await handleToolAction(action);
                });
            });
        }
        
        async function handleToolAction(action) {
            const currentCode = document.getElementById('codeEditor').value;
            
            switch (action) {
                case 'ai-debug':
                    const debugResponse = await window.aiAgent.debugCode('Please analyze this code for errors and issues');
                    addChatMessage('agent', debugResponse);
                    break;
                    
                case 'ai-optimize':
                    const optimizeResponse = await window.aiAgent.improveCode('performance');
                    addChatMessage('agent', optimizeResponse);
                    break;
                    
                case 'ai-explain':
                    const explainResponse = await window.aiAgent.askCodeQuestion('Please explain how this code works');
                    addChatMessage('agent', explainResponse);
                    break;
                    
                case 'ai-generate':
                    const prompt = prompt('What would you like me to generate?');
                    if (prompt) {
                        const generateResponse = await window.aiAgent.generateCode(prompt);
                        addChatMessage('agent', generateResponse);
                    }
                    break;
                    
                case 'zen-mode':
                    window.gooseCode.toggleZenMode();
                    break;
                    
                case 'focus-mode':
                    window.gooseCode.toggleFocusMode();
                    break;
                    
                case 'theme-toggle':
                    document.body.classList.toggle('light-theme');
                    break;
                    
                default:
                    // Handle existing tool actions
                    window.gooseCode.executeTool(action);
            }
        }
        
        function setupProjectManagement() {
            document.getElementById('exportBtn').addEventListener('click', () => {
                window.gooseCode.exportProject();
            });
            
            document.getElementById('importBtn').addEventListener('click', () => {
                document.getElementById('importFile').click();
            });
            
            document.getElementById('importFile').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    window.gooseCode.importProject(file);
                }
            });
        }
        
        function showTemplateSelector() {
            document.getElementById('templateSelector').style.display = 'block';
        }
        
        function hideTemplateSelector() {
            document.getElementById('templateSelector').style.display = 'none';
        }
        
        // Template selection
        document.querySelectorAll('[data-template]').forEach(item => {
            item.addEventListener('click', (e) => {
                const template = e.target.dataset.template;
                loadTemplate(template);
                hideTemplateSelector();
            });
        });
        
        function loadTemplate(templateName) {
            const templates = {
                'html5': `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Project</title>
</head>
<body>
    <h1>Hello World!</h1>
</body>
</html>`,
                
                'canvas-game': `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Game</title>
    <style>
        body { margin: 0; padding: 20px; background: #222; color: white; text-align: center; }
        canvas { border: 2px solid #fff; background: #000; }
    </style>
</head>
<body>
    <h1>Simple Canvas Game</h1>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <p>Use arrow keys to move</p>
    
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        const player = { x: 400, y: 300, size: 20, speed: 5 };
        const keys = {};
        
        document.addEventListener('keydown', (e) => keys[e.key] = true);
        document.addEventListener('keyup', (e) => keys[e.key] = false);
        
        function update() {
            if (keys['ArrowUp']) player.y -= player.speed;
            if (keys['ArrowDown']) player.y += player.speed;
            if (keys['ArrowLeft']) player.x -= player.speed;
            if (keys['ArrowRight']) player.x += player.speed;
            
            // Keep player in bounds
            player.x = Math.max(player.size, Math.min(canvas.width - player.size, player.x));
            player.y = Math.max(player.size, Math.min(canvas.height - player.size, player.y));
        }
        
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw player
            ctx.fillStyle = '#4CAF50';
            ctx.fillRect(player.x - player.size/2, player.y - player.size/2, player.size, player.size);
        }
        
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        gameLoop();
    </script>
</body>
</html>`
            };
            
            const template = templates[templateName];
            if (template) {
                document.getElementById('codeEditor').value = template;
                window.gooseCode.updateLineNumbers();
                window.gooseCode.updatePreview();
                window.gooseCode.addConsoleMessage(`${templateName} template loaded`, 'info');
            }
        }
    </script>
</body>
</html>
